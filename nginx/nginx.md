# Nginx
---

## Nginx是什么
- Nginx是一个拥有高性能HTTP和反向代理服务器，其特点是占用内存少，并发能力强，并且在现实中，nginx的并发能力要比在同类型的网页服务器中表现要好
- Nginx专为性能优化而开发，最重要的要求便是性能，且十分注重效率，有报告nginx能支持高达50000个并发连接数
## 正向代理和反向代理

Nginx 是一个**反向代理服务器**

正向代理：局域网中的电脑用户想要直接访问网络是不可行的，只能通过代理服务器（Server）来访问，这种代理服务就被称为正向代理。

反向代理：客户端无法感知代理，因为客户端访问网络不需要配置，只要把请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据，然后再返回到客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴露的是代理服务器地址，隐藏了真实服务器IP地址。

## 负载均衡

负载均衡：是高可用网络基础架构的关键组件，通常用于将工作负载分布到多个服务器来提高网站、应用、数据库或其他服务的性能和可靠性。

如果没有负载均衡，客户端与服务端的操作通常是：客户端请求服务端，然后服务端去数据库查询数据，将返回的数据带给客户端：

但随着客户端越来越多，数据，访问量飞速增长，这种情况显然无法满足，客户端的请求和相应都是通过服务端的，那么我们加大服务端的量，让多个服务端分担
但此时对于客户端而言，他去访问这个地址就是固定的，才不会去管那个服务端有时间，你只要给我返回出数据就OK了，所以我们就需要一个“管理者“，客户端直接找管理者，再由管理者分配谁处理谁的数据，从而减轻服务端的压力，而这个管理者就是反向代理服务器，而端口号就是这些服务端的工号。


## 动静分离

将动态资源和静态资源分离出来，交给不同的服务器去解析，这样就加快了解析的速度，从而降低由单个服务器的压力

## 安装nginx
```shell
apt install nginx
```

- 查看版本：./nginx -v
- 启动：./nginx
- 关闭：./nginx -s stop(推荐) 或 ./nginx -s quit
- 重新加载nginx配置：./nginx -s reload

## 配置文件

配置文件分为三个模块：

- 全局块：从配置文件开始到events块之间，主要是设置一些影响nginx服务器整体运行的配置指令。（按道理说：并发处理服务的配置时，值越大，可支持的并发处理量越多，但此时会受到硬件、软件等设备等的制约）
- events块：影响nginx服务器与用户的网络连接，常用的设置包括是否开启对多workprocess下的网络连接进行序列化，是否允许同时接收多个网络连接等等
- http块：如反向代理和负载均衡都在此配置


## location匹配规则
共有四种方式：
```shell
    location[ = | ~ | ~* | ^~ ] url {
    
    }
```

- = ：精确匹配，用于不含正则表达式的url前，要求字符串与url严格匹配，完全相等时，才能停止向下搜索并处理请求
- ^~：用于不含正则表达式的url前，要求ngin服务器找到表示url和字符串匹配度最高的location后，立即使用此location处理请求，而不再匹配
- ~ ：最佳匹配，用于表示url包含正则表达式，并且区分大小写。
- ~*：与~一样，只是不区分大小写

**注意：**

- 如果 url 包含正则表达式，则不需要 ~ 作为开头表示
- nginx的匹配具有优先顺序，一旦匹配上就会立马退出，不再进行向下匹配

##